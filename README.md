# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ #1

## Continuous Integration & Continuous Delivery

### –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞

–í —Ä–∞–º–∫–∞—Ö –ø–µ—Ä–≤–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–µ–π—à–µ–µ –≤–µ–± –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞–±–æ—Ä
–æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ —Å—É—â–Ω–æ—Å—Ç—å—é Person. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–ª–∏–∑–∞ –Ω–∞ Heroku.

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API:

* `GET /persons/{personId}` ‚Äì –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–µ–ª–æ–≤–µ–∫–µ;
* `GET /persons` ‚Äì –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –≤—Å–µ–º –ª—é–¥—è–º;
* `POST /persons` ‚Äì —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –æ —á–µ–ª–æ–≤–µ–∫–µ;
* `PATCH /persons/{personId}` ‚Äì –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –æ —á–µ–ª–æ–≤–µ–∫–µ;
* `DELETE /person/{personId}` ‚Äì —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ —á–µ–ª–æ–≤–µ–∫–µ.

[–û–ø–∏—Å–∞–Ω–∏–µ API](person-service.yaml) –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAPI.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* –ò—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ Github. –î–ª—è —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ Github actions.
* –°–±–æ—Ä–∫—É, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –¥–µ–ø–ª–æ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —à–∞–≥–∞–º–∏.
* –ó–∞–ø—Ä–æ—Å—ã / –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
* –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –ø–æ id –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å HTTP —Å—Ç–∞—Ç—É—Å 404 Not Found.
* –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –æ —á–µ–ª–æ–≤–µ–∫–∞ (–º–µ—Ç–æ–¥ POST /person) –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å HTTP —Å—Ç–∞—Ç—É—Å 201 Created —Å –ø—É—Å—Ç—ã–º —Ç–µ–ª–æ–º –∏
  Header `Location: /api/v1/persons/{personId}`, –≥–¥–µ personId ‚Äì id —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏.
* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 4-5 unit-—Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–≤–µ—Ä–Ω—É—Ç–æ –≤ docker.
* –î–µ–ø–ª–æ–π –Ω–∞ Heroku —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ GitHub Actions, –¥–ª—è –¥–µ–ø–ª–æ—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å docker. –î–ª—è –¥–µ–ø–ª–æ—è _–Ω–µ–ª—å–∑—è_
  –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Heroku CLI –∏–ª–∏ webhooks.
* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π.
* –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ Heroku, —á–µ—Ä–µ–∑ newman –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
  –ª–æ–∫–∞–ª—å–Ω–æ, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Postman
  –∫–æ–ª–ª–µ–∫—Ü–∏—é [lab1.postman_collection.json](postman/%5Binst%5D%20Lab1.postman_collection.json)]) –∏
  environment [[local] lab1.postman_environment.json](postman/%5Binst%5D%5Blocal%5D%20Lab1.postman_environment.json).
* –í [[inst][heroku] Lab1.postman_environment.json](postman/%5Binst%5D%5Bheroku%5D%20Lab1.postman_environment.json)
  –∑–∞–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `baseUrl` –Ω–∞ –∞–¥—Ä–µ—Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞ heroku.
* –í [build.yml](.github/workflows/build.yml) –¥–æ–ø–∏—Å–∞—Ç—å —à–∞–≥–∏ –Ω–∞ —Å–±–æ—Ä–∫—É, –ø—Ä–æ–≥–æ–Ω unit-—Ç–µ—Å—Ç–æ–≤ –∏ –¥–µ–ø–ª–æ–π –Ω–∞ heroku.

### –ü–æ—è—Å–Ω–µ–Ω–∏—è

* [–ü—Ä–∏–º–µ—Ä](https://github.com/Romanow/person-service) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Kotlin / Spring.
* –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Postgres –≤ docker, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `docker compose up -d`,
  –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Postgres 13, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ë–î persons –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `program:test`.
* –î–ª—è —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [GitHub Actions](https://docs.github.com/en/actions).
* –î–ª—è –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [Github Marketplace](https://github.com/marketplace).
* –ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç [Heroku](https://devcenter.heroku.com/articles/how-heroku-works).
* –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ë–î –Ω–∞ Heroku –∑–∞—Ö–æ–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Dashboard –≤ —Ä–∞–∑–¥–µ–ª Resources –∏ –≤ –±–ª–æ–∫–µ Add-ons –∏—â–µ—Ç–µ Heroku Postgres. –î–ª—è
  –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ —Å–∞–º—É –ë–î –∏ –≤—ã–±–∏—Ä–∞–µ—Ç–µ —Ä–∞–∑–¥–µ–ª Settings -> Database Credentials.

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞ k8s —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º kind

```shell
$ kind create cluster --config kind.yml
Creating cluster "kind" ...
 ‚úì Ensuring node image (kindest/node:v1.25.2) üñº
 ‚úì Preparing nodes üì¶
 ‚úì Writing configuration üìú
 ‚úì Starting control-plane üïπÔ∏è
 ‚úì Installing CNI üîå
 ‚úì Installing StorageClass üíæ
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind

Have a nice day! üëã

$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml

$ echo "127.0.0.1    person-service" | sudo tee -a /etc/hosts    

$ skaffold dev

$ curl http://person-service.local/manage/health
```

### –ü—Ä–∏–µ–º –∑–∞–¥–∞–Ω–∏—è

1. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è —É –≤–∞—Å —Å–æ–∑–¥–∞–µ—Ç—Å—è fork —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2. –î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ –≤–µ—Ç–∫—É develop –∏ –≤—Å—é —Ä–∞–±–æ—Ç—É –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –≤ –Ω–µ–π. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–¥–µ–ª–∞–ª–∏
   –∑–∞–¥–∞–Ω–∏–µ, _–≤—Å–µ_ —Ç–µ—Å—Ç—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ postman –ø—Ä–æ—Ö–æ–¥—è—Ç _–ª–æ–∫–∞–ª—å–Ω–æ_ —É—Å–ø–µ—à–Ω–æ, –≤—ã —Å–ª–∏–≤–∞–µ—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ master –∏ —Å–æ–∑–¥–∞–µ—Ç–µ
   Pull Request –∏–∑ –≤–µ—Ç–∫–∏ master –≤ –≥–ª–∞–≤–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
3. –î–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ Github Actions –Ω—É–∂–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–π—Ç–∏ –≤–æ –≤–∫–ª–∞–¥–∫—É Actions –∏ –Ω–∞–∂–∞—Ç—å `allow actions`.
4. –ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é, Github Actions —Å—Ç–∞—Ä—Ç—É—é—Ç –¥–ª—è –≤–µ—Ç–∫–∏ master –∏ Pull Request (—ç—Ç–æ –æ–ø–∏—Å–∞–Ω–æ
   –≤ [build.yaml](.github/workflows/build.yml)), —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–∏–Ω—É—Ç –≤
   –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ `bmstu-rsoi` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∏ –ø–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –º–∏–Ω—É—Ç, —Å–±–æ—Ä–∫–∏ —É –≤—Å–µ—Ö –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å.
5. –î–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ heroku –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `API_KEY`, –µ–≥–æ –Ω—É–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, —Ç.–∫. –ø—Ä–∏ Pull Request –∫–ª—é—á,
   –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ –≤–∞—à–∏—Ö secret, –Ω–µ –≤–∏–¥–µ–Ω.